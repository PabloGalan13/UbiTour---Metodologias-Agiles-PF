<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <title>Restablecer contraseña - UbiTour</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
</head>

<body class="bg-gray-50 text-gray-900">

    <main class="pt-20">
        <div class="max-w-md mx-auto bg-white rounded-2xl shadow-sm border p-8">
            <h1 class="text-lg font-semibold text-center mb-1">Restablecer contraseña</h1>

            <p class="text-xs text-gray-500 text-center mb-6">
                Ingresa tu nueva contraseña para continuar.
            </p>

            <form id="resetForm"
                hx-post="http://localhost:3000/auth/reset-password"
                hx-target="#reset-result"
                hx-swap="innerHTML"
                class="space-y-4">

                <input type="hidden" name="token" id="tokenField" />

                <div>
                    <label class="block text-xs font-medium mb-1">Nueva contraseña</label>
                    <input name="password" type="password" minlength="6" required
                        class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-blue-500/60 focus:border-blue-500">
                </div>

                <button type="submit"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2.5 rounded-full text-sm font-medium mt-2">
                    Restablecer contraseña
                </button>
            </form>

            <div id="reset-result" class="mt-4 text-xs text-center text-gray-700"></div>
        </div>
    </main>

    <script>
        // Obtener token de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get("token");

        if (!token) {
            document.getElementById("resetForm").innerHTML =
                '<p class="text-red-600 text-center text-xs">Token inválido.</p>';
        } else {
            document.getElementById("tokenField").value = token;
        }

        // Manejo de errores del backend
        document.body.addEventListener("htmx:responseError", function (event) {
            const xhr = event.detail.xhr;
            let message = "No se pudo restablecer la contraseña.";

            try {
                const data = JSON.parse(xhr.responseText);
                if (data.message) message = data.message;
            } catch (e) { }

            document.getElementById("reset-result").innerHTML =
                '<p class="text-xs text-red-600 mt-2">' + message + '</p>';
        });
    </script>

</body>

</html>
